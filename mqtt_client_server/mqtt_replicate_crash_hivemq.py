import socket
import scapy.all as scapy
import time
from binascii import unhexlify
packet_lst_normal = ["308c08000a746573742f617373657434344e4742384257453346424c55415355463038494d324e43325948313443374e3345434547545830494742395233434c54524a4739325235594847484a435449324a4452413632385a514953564d4e53465a573835344d54535536574e5031414954394c42545730474e354153354b47344351545a4a5a4e5242314c53423032384736314245485839595054395450503353424f39433047563541563653435630564a4f5051375746364d3451534930425a55564552494c385139564c5a47553832415049554c5439305542484339595049594c50304a41483153474344434a4f4b30494249423650464a4544585a53364536333539494737344d32584244574330434f4f5a56574f5a3944585a4c52574e424a55324d443143414d324c31385338545a5853434239413352394b465749314a393151525933353959504a59365259314c585055394e4a51545457464f505a464d485248364d4e3343393153324739514134514a483051465a32333939515956585942333042334b4e4c51484159435a535447374336313050584c383537354a4c593044594e505747434547335a464e4945584156554f585248315a4857483835584a4941505058384d5354494842304c32335345424c49584553364b4e5a324e544f57544345595543573446583252523435504d4c423156594b345053363239345846513852314d35454331564c324d5057574e4e3731564357495a334e4646395a34504f3147495139594d394f4a5943324139474f4b434b4e4f39324b56445748525642525950523257445734565951385754504f54515a413244554938303933474139474858324232584f41513738593951593641543844444458554541384741554b385a4e544f3654485643504e45365a4c555749585035454151394f39455359424c4a32424c503535324f50474d55444453444c35484e4a4b475746494636495936334f424c5a36483145525239555039395355444d544e38474746423455375538435559334d5259413943433037505837544d394b564c4e46414443384a4b4958384e57355243364939394e53504b5a424e5045513446384636325554543650354e584957543054374f5a515a394e3733323843454341414e52584b5930505259394531315931593946485a5149323739354f5532473357355059464a5a30423959425044364751474447325a3447345348444b5139334e5041374641474b4232553649565a415a534b4354563344363450434e4b4d4a395156575355454c574f305a46453945324b4944365657484c495047385a565330533247545a444b563345583857595550525857454d544538425045543357594c58544c4849424e4453595632553538425555494e5835484c3041564e38533256384931564b4d325250354a52505a"]
packet_lst = ["d2528b25075b8cfe010d1cb5ba4f801801e9619700000101080a598bbf27f7243bfe820f76f1000a746573742f617373657400",
              "d252d843075b7a6d304aa9011a4280180120a39400000101080a55e92099f3819bc8fd0e05bf000a746573742f6173736574",
              "d252b3c7075b3fe9ca2a3a7426fb801801f2c90100000101080a55bb9b95f3540f2ba20e1870000a746573742f6173736574",
              "d252ade5075bc865d58221147382801801f5894400000101080a54bcb297f254fecbfb5f020004746573744f5630534a4d4635343642344b304c314c5045554350514a5a464f314a3751544b4e4f4c4a4151314f4c5557554b594735444932465950344b31585131534733424f4a564b4c424432334d3930343133394644434e504b423035303141514e36314a375935434753494d4947494f5245485032315757493249585539333731314548364c4b374859584f3155415142385345354d355945444e475a51374650344c494a5939363146534b4f5a454e5446324247465442505051314f524b5636454549574b483446584f5041464f304859443535374f364a325748324434545a37365a42574d4e395341373851585647584c484454453653583933544d57385844",
              "080a54bce184f2554529308c01000a746573742f68656c6c6f49453558415555434a57564d473858305843375857564343344e324630355a4158483453335a45315a4750453236555a52593552585750315858505351445a5a4a31425a524c3539475631484b3738344f504a514631533842415259315448564550334d364d35354f4d43484a50575049473645384154573849304557574651",
              "302c000a746573742f61737365744559373648574a4e45333849445553395750384941534a375652344731434438",
            #   "308c08000a746573742f617373657434344e4742384257453346424c55415355463038494d324e43325948313443374e3345434547545830494742395233434c54524a4739325235594847484a435449324a4452413632385a514953564d4e53465a573835344d54535536574e5031414954394c42545730474e354153354b47344351545a4a5a4e5242314c53423032384736314245485839595054395450503353424f39433047563541563653435630564a4f5051375746364d3451534930425a55564552494c385139564c5a47553832415049554c5439305542484339595049594c50304a41483153474344434a4f4b30494249423650464a4544585a53364536333539494737344d32584244574330434f4f5a56574f5a3944585a4c52574e424a55324d443143414d324c31385338545a5853434239413352394b465749314a393151525933353959504a59365259314c585055394e4a51545457464f505a464d485248364d4e3343393153324739514134514a483051465a32333939515956585942333042334b4e4c51484159435a535447374336313050584c383537354a4c593044594e505747434547335a464e4945584156554f585248315a4857483835584a4941505058384d5354494842304c32335345424c49584553364b4e5a324e544f57544345595543573446583252523435504d4c423156594b345053363239345846513852314d35454331564c324d5057574e4e3731564357495a334e4646395a34504f3147495139594d394f4a5943324139474f4b434b4e4f39324b56445748525642525950523257445734565951385754504f54515a413244554938303933474139474858324232584f41513738593951593641543844444458554541384741554b385a4e544f3654485643504e45365a4c555749585035454151394f39455359424c4a32424c503535324f50474d55444453444c35484e4a4b475746494636495936334f424c5a36483145525239555039395355444d544e38474746423455375538435559334d5259413943433037505837544d394b564c4e46414443384a4b4958384e57355243364939394e53504b5a424e5045513446384636325554543650354e584957543054374f5a515a394e3733323843454341414e52584b5930505259394531315931593946485a5149323739354f5532473357355059464a5a30423959425044364751474447325a3447345348444b5139334e5041374641474b4232553649565a415a534b4354563344363450434e4b4d4a395156575355454c574f305a46453945324b4944365657484c495047385a565330533247545a444b563345583857595550525857454d544538425045543357594c58544c4849424e4453595632553538425555494e5835484c3041564e38533256384931564b4d325250354a52505a",
            #   "308c08000a746573742f617373657434344e4742384257453346424c55415355463038494d324e43325948313443374e3345434547545830494742395233434c54524a4739325235594847484a435449324a4452413632385a514953564d4e53465a573835344d54535536574e5031414954394c42545730474e354153354b47344351545a4a5a4e5242314c53423032384736314245485839595054395450503353424f39433047563541563653435630564a4f5051375746364d3451534930425a55564552494c385139564c5a47553832415049554c5439305542484339595049594c50304a41483153474344434a4f4b30494249423650464a4544585a53364536333539494737344d32584244574330434f4f5a56574f5a3944585a4c52574e424a55324d443143414d324c31385338545a5853434239413352394b465749314a393151525933353959504a59365259314c585055394e4a51545457464f505a464d485248364d4e3343393153324739514134514a483051465a32333939515956585942333042334b4e4c51484159435a535447374336313050584c383537354a4c593044594e505747434547335a464e4945584156554f585248315a4857483835584a4941505058384d5354494842304c32335345424c49584553364b4e5a324e544f57544345595543573446583252523435504d4c423156594b345053363239345846513852314d35454331564c324d5057574e4e3731564357495a334e4646395a34504f3147495139594d394f4a5943324139474f4b434b4e4f39324b56445748525642525950523257445734565951385754504f54515a413244554938303933474139474858324232584f41513738593951593641543844444458554541384741554b385a4e544f3654485643504e45365a4c555749585035454151394f39455359424c4a32424c503535324f50474d55444453444c35484e4a4b475746494636495936334f424c5a36483145525239555039395355444d544e38474746423455375538435559334d5259413943433037505837544d394b564c4e46414443384a4b4958384e57355243364939394e53504b5a424e5045513446384636325554543650354e584957543054374f5a515a394e3733323843454341414e52584b5930505259394531315931593946485a5149323739354f5532473357355059464a5a30423959425044364751474447325a3447345348444b5139334e5041374641474b4232553649565a415a534b4354563344363450434e4b4d4a395156575355454c574f305a46453945324b4944365657484c495047385a565330533247545a444b563345583857595550525857454d544538425045543357594c58544c4849424e4453595632553538425555494e5835484c3041564e38533256384931564b4d325250354a52505a",
              "308c04000a746573742f68656c6c6f534a47393456343341585156505945565843464f495645434a384e54334346444a56304836514f3956594c395a5159435256535034334236435656524c4141584a59513042465a534f394f31464e37304945423431515837474241315138574c52454d4f475255365936344d3833414b54454a31414f334156424a4145494d4a4c504857344b42484435495356515a595034345a51423855595943564f304149474c4b363745423637573934425439324e4e4d384f4b3248445543554451525a4e4753364f39594d59444c564e424a454c4445494848484f48384252454e38394530394935314145565a5432434a56324d4d334f385235433739344b514d314f4d4b484638393542324e4432525251565a564447564a474a49494a365446385634354f4b4c57474d4b354f4746574c4f375832535142484e554f37543155424a38343950443156574b47324c36395342594d4a473455564c4c41434c47424e42334832464f415959334f59464b52523235323138575a424635304a3447534a4c34553543474d335639324c4658483039464647583334455a3132333131523855524b595a4445394447423555414a57394b45313854465132444638333031425a394c424e354e4550364855584e43324f4e4631324350554b4c31575734543038384d3839345946584c5137463550384957485535425941384737484436344e58"]

def send_one_by_one(ss,lst,t):
    while t>0:
        print(t)
        for ele in lst:
            time.sleep(1)
            ss.sendall(unhexlify(ele))
        t = t-1

def send_one(ss,pkt,t):
    while t>0:
        print(t)
        ss.sendall(unhexlify(pkt))
        time.sleep(1)
        t = t-1



host = "10.13.210.82"
port = 1883                  # The same port as used by the server
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
i = 0
# s.sendall(unhexlify('101a00044d51545404c2003c0000000561646d696e000561646d696e'))
# send_one_by_one(s,packet_lst,10)
send_one(s,packet_lst[0],10)
# while(i<10):
#     print(i)
#     i = i+1
#     s.sendall(unhexlify(packet_lst[0]))
time.sleep(1)
# s.sendall(unhexlify('308c08000a746573742f617373657444584b32534d545443594a555151465152374f58393041394b3431523439485237574f39584d555145585a39533644443257494a395a57475a4c41314952514c434d444f4833554934525a56524f385931563734554e4853535434484933585a545a5131394c4f305348315847383752533333384759555a4a3936384d514255313842304e365a50575553544e51375a345853473738554f53434544594a30423742393754325a51383150373447374c354e415149354748574a52335a534957584341474f3430414e4f55394844524d4c4d4d434d39595a30525531585a42454e565544375a38375855424b3436354f3437554145463144574f4e33434d50494746434335364a4556515850393753534147324756374855534e424939593251394145474957414d474d535652575347305a454d514b565856503133504454544b424a36353643584936554b44484e565538454f575a5746554c564a544c3646304e4b57485938585731494431455837354d5641334a584b5a454f56394555434f4d31344a3837363945425738414b314d584432393653364d394e584b314a504e5347504d4f3158334c524e474e314b37445152525647534c58304f5645364b47364f59554e5a514b4d344f41564d47373958494e4443484854364f304236553659574e574446494559445659593051354a4b4233365935503531384b453439444857304c51334a34524f5a554142575656473338594349385731324247463742444953434a373843544d50524b44314f43384f4e304a4b553144564e56375951433230414945364e3138384c594f564a5a4632455230565635363545394e44385349425a4f564e4648384d444c4b504f4958324b44444e333559345437394837514b43424c4c544d42594351575943465135313153414f4750464651424c4f4c4c554c43444c4e5352383756584a31324b365748414d4452515642494c35374d454f47354d4b353645374f544842534d304641324e4d58344b334b4b4d4d315a303853344157564555464e32544c42585a44315730584c42354737454b475536324433464f554e574d494e4634334343365a415543514d4956373434324f5a534e3453574257534f43383731345035424d34543959393336363256345358354645314b503254484554303432364251304c393159355737384c4c3641494e53545036555954564c35584538364b575337575042454941574d5a474638494343454b33413630375a354948455441574f5145464c4f334739443450545557325645465741594c4a4c5733334650475845554c445a435353484e334f4f504d514b3659433848314532333754494e443849534e32343357484d423459504e5744414f3947354a4a4658424d503851355653444857475037435a3349465a564a4739'))
# 308c08000a746573742f617373657444584b32534d545443594a555151465152374f58393041394b3431523439485237574f39584d555145585a39533644443257494a395a57475a4c41314952514c434d444f4833554934525a56524f385931563734554e4853535434484933585a545a5131394c4f305348315847383752533333384759555a4a3936384d514255313842304e365a50575553544e51375a345853473738554f53434544594a30423742393754325a51383150373447374c354e415149354748574a52335a534957584341474f3430414e4f55394844524d4c4d4d434d39595a30525531585a42454e565544375a38375855424b3436354f3437554145463144574f4e33434d50494746434335364a4556515850393753534147324756374855534e424939593251394145474957414d474d535652575347305a454d514b565856503133504454544b424a36353643584936554b44484e565538454f575a5746554c564a544c3646304e4b57485938585731494431455837354d5641334a584b5a454f56394555434f4d31344a3837363945425738414b314d584432393653364d394e584b314a504e5347504d4f3158334c524e474e314b37445152525647534c58304f5645364b47364f59554e5a514b4d344f41564d47373958494e4443484854364f304236553659574e574446494559445659593051354a4b4233365935503531384b453439444857304c51334a34524f5a554142575656473338594349385731324247463742444953434a373843544d50524b44314f43384f4e304a4b553144564e56375951433230414945364e3138384c594f564a5a4632455230565635363545394e44385349425a4f564e4648384d444c4b504f4958324b44444e333559345437394837514b43424c4c544d42594351575943465135313153414f4750464651424c4f4c4c554c43444c4e5352383756584a31324b365748414d4452515642494c35374d454f47354d4b353645374f544842534d304641324e4d58344b334b4b4d4d315a303853344157564555464e32544c42585a44315730584c42354737454b475536324433464f554e574d494e4634334343365a415543514d4956373434324f5a534e3453574257534f43383731345035424d34543959393336363256345358354645314b503254484554303432364251304c393159355737384c4c3641494e53545036555954564c35584538364b575337575042454941574d5a474638494343454b33413630375a354948455441574f5145464c4f334739443450545557325645465741594c4a4c5733334650475845554c445a435353484e334f4f504d514b3659433848314532333754494e443849534e32343357484d423459504e5744414f3947354a4a4658424d503851355653444857475037435a3349465a564a4739
# s.sendall(unhexlify('57cb01000a746573742f68656c6c6f375849394b37535231575a495946445654444d5a5753484e4c31373439364e49573741514c5637503755385a32444136505a4c4334324642394a425a38555434505158434c3655424d4e4e3643525247484e354a5754425a51363759385a395a43584a4355374243354c5a5142574a4757364850424d3846434c383038454935'))
data = s.recv(1024)
s.close()
print('Received', repr(data))
